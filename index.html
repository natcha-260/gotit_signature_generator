
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>SHA256withRSA Signature Generator</title>
        <script
            src="https://unpkg.com/jsrsasign@11.1.0/jsrsasign-all-min.js"></script>
        <script
            src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
        <style>
        :root {
            --font-size: 16px;
            --background: #ffffff;
            --foreground: #1e293b;
            --card: #ffffff;
            --card-foreground: #1e293b;
            --primary: #4f46e5;
            --primary-foreground: #ffffff;
            --secondary: #f1f5f9;
            --secondary-foreground: #1e293b;
            --muted: #f1f5f9;
            --muted-foreground: #64748b;
            --accent: #e2e8f0;
            --accent-foreground: #1e293b;
            --destructive: #ef4444;
            --destructive-foreground: #ffffff;
            --border: rgba(0, 0, 0, 0.1);
            --input: #f8fafc;
            --ring: #4f46e5;
            --radius: 0.5rem;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 50%, #c7d2fe 100%);
            color: var(--foreground);
            line-height: 1.6;
            min-height: 100vh;
            padding: 3rem 1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header-icon {
            display: inline-block;
            padding: 0.75rem;
            background: var(--primary);
            border-radius: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 10px 25px rgba(79, 70, 229, 0.2);
        }

        .header-icon svg {
            width: 2rem;
            height: 2rem;
            color: var(--primary-foreground);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--foreground);
            margin-bottom: 0.75rem;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--muted-foreground);
            max-width: 32rem;
            margin: 0 auto;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 1024px) {
            .grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .card {
            background: var(--card);
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-icon {
            padding: 0.5rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-indigo {
            background: #e0e7ff;
        }

        .icon-blue {
            background: #dbeafe;
        }

        .icon-green {
            background: #dcfce7;
        }

        .icon-purple {
            background: #f3e8ff;
        }

        .card-icon svg {
            width: 1.25rem;
            height: 1.25rem;
        }

        .icon-indigo svg {
            color: var(--primary);
        }

        .icon-blue svg {
            color: #2563eb;
        }

        .icon-green svg {
            color: #16a34a;
        }

        .icon-purple svg {
            color: #9333ea;
        }

        h2 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--foreground);
        }

        .card-subtitle {
            font-size: 0.875rem;
            color: var(--muted-foreground);
        }

        .button-group {
            display: flex;
            gap: 0.5rem;
        }

        button {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid transparent;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .button-primary {
            background: var(--primary);
            color: var(--primary-foreground);
        }

        .button-primary:hover {
            background: #3730a3;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(79, 70, 229, 0.3);
        }

        .button-secondary {
            background: var(--secondary);
            color: var(--secondary-foreground);
        }

        .button-secondary:hover {
            background: #e2e8f0;
        }

        .button-main {
            width: 100%;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, var(--primary), #2563eb);
            color: var(--primary-foreground);
            border-radius: 0.75rem;
            font-size: 1.1rem;
            margin-top: 1rem;
        }

        .button-main:hover {
            background: linear-gradient(135deg, #3730a3, #1d4ed8);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79, 70, 229, 0.4);
        }

        .button-main:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--input);
            color: var(--foreground);
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s ease;
        }

        textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .status-message {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.5rem;
        }

        .status-success {
            background: #dcfce7;
            color: #166534;
        }

        .status-error {
            background: #fef2f2;
            color: #dc2626;
        }

        .status-warning {
            background: #fefce8;
            color: #ca8a04;
        }

        .status-info {
            background: #eff6ff;
            color: #1d4ed8;
        }

        .checkbox-container {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            cursor: pointer;
            padding: 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease;
        }

        .checkbox-container:hover {
            background: #f8fafc;
        }

        input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            accent-color: var(--primary);
            cursor: pointer;
        }

        .checkbox-content {
            flex: 1;
        }

        .checkbox-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .badge {
            padding: 0.125rem 0.5rem;
            background: #dcfce7;
            color: #166534;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .output-container {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 0.5rem;
            padding: 1rem;
            border: 1px solid var(--border);
            min-height: 7.5rem;
            max-height: 12.5rem;
            overflow-y: auto;
        }

        .output-container.large {
            max-height: 25rem;
        }

        .output-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--muted-foreground);
            font-style: italic;
        }

        .output-text {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            word-break: break-all;
            color: var(--foreground);
            white-space: pre-wrap;
        }

        .instructions {
            background: linear-gradient(135deg, #eff6ff, #e0e7ff);
            border: 1px solid #93c5fd;
            border-radius: 0.75rem;
            padding: 1.5rem;
        }

        .instructions h3 {
            color: #1e40af;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .info-icon {
            width: 1.5rem;
            height: 1.5rem;
            background: #2563eb;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .instructions ol {
            list-style: none;
            counter-reset: step;
        }

        .instructions li {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            color: #1e40af;
            counter-increment: step;
        }

        .instructions li::before {
            content: counter(step) ".";
            flex-shrink: 0;
            font-weight: 500;
        }

        .spinner {
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid white;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .hidden {
            display: none !important;
        }

        .copy-success svg {
            color: #16a34a;
        }

        .copy-success span {
            color: #16a34a;
        }

        .double-encode-highlight {
            color: #9333ea;
            font-weight: 500;
        }
    </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <div class="header-icon">
                    <i data-lucide="lock"></i>
                </div>
                <h1>SHA256withRSA Signature Generator</h1>
                <p class="subtitle">
                    Generate cryptographic signatures for Buzzebees API
                    integration. Your
                    private key is stored securely in your browser and never
                    leaves your
                    device.
                </p>
            </div>

            <div class="grid">
                <!-- Left Column - Input -->
                <div>
                    <!-- Private Key Input -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon icon-indigo">
                                    <i data-lucide="key"></i>
                                </div>
                                <div>
                                    <h2>Private Key</h2>
                                    <p class="card-subtitle">Stored locally in
                                        your browser</p>
                                </div>
                            </div>
                            <div class="button-group">
                                <button id="generateKeysBtn"
                                    class="button-primary">
                                    <span id="generateKeysText">Generate
                                        Keys</span>
                                    <div id="generateKeysSpinner"
                                        class="spinner hidden"></div>
                                </button>
                                <button id="clearKeyBtn"
                                    class="button-secondary hidden">
                                    Clear
                                </button>
                            </div>
                        </div>
                        <textarea
                            id="privateKeyInput"
                            placeholder="-----BEGIN PRIVATE KEY-----&#10;MIIEvgIBADANBgkqhkiG9w0BAQEFAASC...&#10;-----END PRIVATE KEY-----"
                            rows="8"></textarea>
                        <div id="privateKeyStatus"
                            class="status-message status-success hidden">
                            <i data-lucide="check-circle"></i>
                            <span>Private key loaded</span>
                        </div>
                    </div>

                    <!-- JSON Payload Input -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon icon-blue">
                                    <i data-lucide="file-json"></i>
                                </div>
                                <div>
                                    <h2>Request Payload</h2>
                                    <p class="card-subtitle">The signature field
                                        will be
                                        auto-excluded</p>
                                </div>
                            </div>
                        </div>
                        <textarea
                            id="jsonPayloadInput"
                            rows="20"></textarea>
                    </div>

                    <!-- Settings -->
                    <div class="card">
                        <h3
                            style="margin-bottom: 1rem; font-size: 1.125rem; font-weight: 600;">Settings</h3>
                        <label class="checkbox-container">
                            <input type="checkbox" id="doubleEncodeCheckbox"
                                checked>
                            <div class="checkbox-content">
                                <div class="checkbox-title">
                                    <span>Double Base64 Encoding</span>
                                    <span id="doubleEncodeBadge"
                                        class="badge">ON</span>
                                </div>
                                <p class="card-subtitle">
                                    Encode the Base64 signature in Base64 again
                                    (Base64(Base64(signature)))
                                </p>
                            </div>
                        </label>
                    </div>

                    <!-- Generate Button -->
                    <button id="generateSignatureBtn" class="button-main">
                        <i data-lucide="lock"></i>
                        <span id="generateButtonText">Generate Signature</span>
                        <div id="generateButtonSpinner"
                            class="spinner hidden"></div>
                    </button>
                </div>

                <!-- Right Column - Output -->
                <div>
                    <!-- Success Message -->
                    <div id="successMessage"
                        class="status-message status-success animate-pulse hidden">
                        <i data-lucide="check-circle"></i>
                        <div>
                            <p style="font-weight: 600;">Signature generated
                                successfully!</p>
                            <p>You can now copy and use it in your API
                                request</p>
                        </div>
                    </div>

                    <!-- Error Display -->
                    <div id="errorMessage"
                        class="status-message status-error hidden">
                        <i data-lucide="alert-circle"></i>
                        <div>
                            <p style="font-weight: 600;">Error</p>
                            <p id="errorText"></p>
                        </div>
                    </div>

                    <!-- Signature Output -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon icon-green">
                                    <i data-lucide="lock"></i>
                                </div>
                                <div>
                                    <h2>Generated Signature</h2>
                                    <p class="card-subtitle"
                                        id="signatureSubtitle">Base64
                                        encoded</p>
                                </div>
                            </div>
                            <button id="copySignatureBtn"
                                class="button-secondary hidden">
                                <i data-lucide="copy"></i>
                                <span>Copy</span>
                            </button>
                        </div>
                        <div class="output-container">
                            <div id="signatureOutput"
                                class="output-placeholder">
                                Signature will appear here after generation
                            </div>
                        </div>
                    </div>

                    <!-- Final Payload Output -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon icon-purple">
                                    <i data-lucide="file-json"></i>
                                </div>
                                <div>
                                    <h2>Complete Payload</h2>
                                    <p class="card-subtitle">Ready to send to
                                        API</p>
                                </div>
                            </div>
                            <button id="copyPayloadBtn"
                                class="button-secondary hidden">
                                <i data-lucide="copy"></i>
                                <span>Copy</span>
                            </button>
                        </div>
                        <div class="output-container large">
                            <div id="payloadOutput" class="output-placeholder">
                                Complete payload will appear here after
                                generation
                            </div>
                        </div>
                    </div>

                    <!-- Instructions -->
                    <div class="instructions">
                        <h3>
                            <div class="info-icon">i</div>
                            How it works
                        </h3>
                        <ol id="instructionsList">
                            <li><span>The signature field is excluded from the
                                    payload</span></li>
                            <li><span>The payload is converted to JSON string
                                    using
                                    JSON.stringify()</span></li>
                            <li><span>The string is signed using SHA256withRSA
                                    with your
                                    private key</span></li>
                            <li><span>The signature is converted to Base64
                                    format</span></li>
                            <li id="doubleEncodeStep"
                                class="double-encode-highlight"><span>The Base64
                                    signature is
                                    encoded in Base64 again</span></li>
                            <li id="finalStep"><span>The signature is added back
                                    to the
                                    payload</span></li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // State variables
        let privateKey = "";
        let doubleEncode = true;
        let copiedTimeout = null;

        // Default JSON payload
        const defaultPayload = `{
  "user_id": "96dafdc1-936c-47ed-984c-bce9ad9a61be",
  "order_id": "ORD123",
  "order_items": [
    {
      "transaction_id": "9cc7e2fe-9e16-4a6d-b81f-91979ca741fd",
      "item_name": {
        "en": "Gift voucher 100k",
        "vi": "Phiếu quà tặng 100k"
      },
      "quantity": 1,
      "redeem_points": 100
    }
  ],
  "signature": ""
}`;

        // DOM elements
        const privateKeyInput = document.getElementById('privateKeyInput');
        const jsonPayloadInput = document.getElementById('jsonPayloadInput');
        const doubleEncodeCheckbox = document.getElementById('doubleEncodeCheckbox');
        const doubleEncodeBadge = document.getElementById('doubleEncodeBadge');
        const generateSignatureBtn = document.getElementById('generateSignatureBtn');
        const generateKeysBtn = document.getElementById('generateKeysBtn');
        const clearKeyBtn = document.getElementById('clearKeyBtn');
        const copySignatureBtn = document.getElementById('copySignatureBtn');
        const copyPayloadBtn = document.getElementById('copyPayloadBtn');
        const privateKeyStatus = document.getElementById('privateKeyStatus');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const signatureOutput = document.getElementById('signatureOutput');
        const payloadOutput = document.getElementById('payloadOutput');
        const signatureSubtitle = document.getElementById('signatureSubtitle');
        const doubleEncodeStep = document.getElementById('doubleEncodeStep');
        const finalStep = document.getElementById('finalStep');

        // Initialize
        function init() {
            // Set default payload
            jsonPayloadInput.value = defaultPayload;
            
            // Load private key from localStorage
            const savedKey = localStorage.getItem('rsa_private_key');
            if (savedKey) {
                privateKey = savedKey;
                privateKeyInput.value = privateKey;
                updatePrivateKeyStatus();
            }
            
            // Update UI based on double encode setting
            updateDoubleEncodeUI();
        }

        // Crypto utilities
        function generateSignature(data, privateKeyPEM, doubleEncode = false) {
            try {
                // Create a Signature object
                const sig = new KJUR.crypto.Signature({ alg: "SHA256withRSA" });
                
                // Initialize with private key
                sig.init(privateKeyPEM);
                
                // Update with data to sign
                sig.updateString(data);
                
                // Generate signature in hex format
                const sigValueHex = sig.sign();
                
                // Convert hex to Base64
                let sigValueBase64 = hextob64(sigValueHex);
                
                // Double encode if requested
                if (doubleEncode) {
                    sigValueBase64 = btoa(sigValueBase64);
                }
                
                return sigValueBase64;
            } catch (error) {
                throw new Error(`Signature generation failed: ${error.message}`);
            }
        }

        async function generateKeyPair() {
            try {
                // Generate RSA key pair (2048 bits)
                const rsaKeypair = KEYUTIL.generateKeypair("RSA", 2048);
                
                // Export private key to PEM format
                const privateKeyPEM = KEYUTIL.getPEM(rsaKeypair.prvKeyObj, "PKCS8PRV");
                
                // Export public key to PEM format
                const publicKeyPEM = KEYUTIL.getPEM(rsaKeypair.pubKeyObj);
                
                return {
                    privateKey: privateKeyPEM,
                    publicKey: publicKeyPEM
                };
            } catch (error) {
                throw new Error(`Key pair generation failed: ${error.message}`);
            }
        }

        // UI update functions
        function updatePrivateKeyStatus() {
            if (privateKey.trim()) {
                privateKeyStatus.classList.remove('hidden');
                clearKeyBtn.classList.remove('hidden');
            } else {
                privateKeyStatus.classList.add('hidden');
                clearKeyBtn.classList.add('hidden');
            }
        }

        function updateDoubleEncodeUI() {
            if (doubleEncode) {
                doubleEncodeBadge.textContent = 'ON';
                doubleEncodeBadge.classList.add('badge');
                signatureSubtitle.textContent = 'Double Base64 encoded';
                doubleEncodeStep.classList.remove('hidden');
                finalStep.innerHTML = '<span>The signature is added back to the payload</span>';
            } else {
                doubleEncodeBadge.textContent = 'OFF';
                doubleEncodeBadge.className = 'badge';
                doubleEncodeBadge.style.background = '#fef2f2';
                doubleEncodeBadge.style.color = '#dc2626';
                signatureSubtitle.textContent = 'Base64 encoded';
                doubleEncodeStep.classList.add('hidden');
                finalStep.innerHTML = '<span>The signature is added back to the payload</span>';
            }
        }

        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
            successMessage.classList.add('hidden');
            // Re-initialize icons for error message
            lucide.createIcons();
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }

        function showSuccess() {
            successMessage.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            // Re-initialize icons for success message
            lucide.createIcons();
            setTimeout(() => {
                successMessage.classList.add('hidden');
            }, 3000);
        }

        function setCopyButtonState(button, isCopied) {
            const icon = button.querySelector('i');
            const text = button.querySelector('span');
            
            if (isCopied) {
                button.classList.add('copy-success');
                icon.setAttribute('data-lucide', 'check-circle');
                text.textContent = 'Copied!';
            } else {
                button.classList.remove('copy-success');
                icon.setAttribute('data-lucide', 'copy');
                text.textContent = 'Copy';
            }
            
            // Re-initialize icons
            lucide.createIcons();
        }

        // Event handlers
        privateKeyInput.addEventListener('input', (e) => {
            privateKey = e.target.value;
            updatePrivateKeyStatus();
            
            // Save to localStorage
            if (privateKey.trim()) {
                localStorage.setItem('rsa_private_key', privateKey);
            }
        });

        doubleEncodeCheckbox.addEventListener('change', (e) => {
            doubleEncode = e.target.checked;
            updateDoubleEncodeUI();
        });

        generateKeysBtn.addEventListener('click', async () => {
            try {
                // Show loading state
                const generateKeysText = document.getElementById('generateKeysText');
                const generateKeysSpinner = document.getElementById('generateKeysSpinner');
                
                generateKeysText.textContent = 'Generating...';
                generateKeysSpinner.classList.remove('hidden');
                generateKeysBtn.disabled = true;
                
                hideError();
                
                const { privateKey: privKey, publicKey: pubKey } = await generateKeyPair();
                
                privateKey = privKey;
                privateKeyInput.value = privateKey;
                updatePrivateKeyStatus();
                
                // Show public key in alert
                const message = `Key pair generated successfully!\n\nYour PUBLIC KEY (share this with Buzzebees):\n\n${pubKey}\n\nThe private key has been loaded into the form. Keep it secure!`;
                alert(message);
                
            } catch (err) {
                showError(err.message);
            } finally {
                // Reset loading state
                const generateKeysText = document.getElementById('generateKeysText');
                const generateKeysSpinner = document.getElementById('generateKeysSpinner');
                
                generateKeysText.textContent = 'Generate Keys';
                generateKeysSpinner.classList.add('hidden');
                generateKeysBtn.disabled = false;
            }
        });

        clearKeyBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to clear the stored private key?')) {
                privateKey = '';
                privateKeyInput.value = '';
                localStorage.removeItem('rsa_private_key');
                updatePrivateKeyStatus();
            }
        });

        generateSignatureBtn.addEventListener('click', () => {
            try {
                hideError();
                
                // Show loading state
                const generateButtonText = document.getElementById('generateButtonText');
                const generateButtonSpinner = document.getElementById('generateButtonSpinner');
                
                generateButtonText.textContent = 'Generating Signature...';
                generateButtonSpinner.classList.remove('hidden');
                generateSignatureBtn.disabled = true;
                
                if (!privateKey.trim()) {
                    throw new Error('Please provide a private key');
                }
                
                const jsonPayload = jsonPayloadInput.value.trim();
                if (!jsonPayload) {
                    throw new Error('Please provide a JSON payload');
                }
                
                // Parse the JSON to validate it
                let payload;
                try {
                    payload = JSON.parse(jsonPayload);
                } catch (e) {
                    throw new Error('Invalid JSON format');
                }
                
                // Step 1: Exclude signature field
                const { signature: _, ...payloadWithoutSignature } = payload;
                
                // Step 2: Convert to string
                const payloadString = JSON.stringify(payloadWithoutSignature);
                
                // Step 3 & 4: Generate signature and convert to Base64
                const generatedSignature = generateSignature(payloadString, privateKey, doubleEncode);
                
                // Create final payload with signature
                const final = {
                    ...payloadWithoutSignature,
                    signature: generatedSignature
                };
                const finalPayload = JSON.stringify(final, null, 2);
                
                // Update UI with results
                signatureOutput.textContent = generatedSignature;
                signatureOutput.classList.remove('output-placeholder');
                signatureOutput.classList.add('output-text');
                copySignatureBtn.classList.remove('hidden');
                
                payloadOutput.textContent = finalPayload;
                payloadOutput.classList.remove('output-placeholder');
                payloadOutput.classList.add('output-text');
                copyPayloadBtn.classList.remove('hidden');
                
                showSuccess();
                
                // Re-initialize icons
                lucide.createIcons();
                
            } catch (err) {
                showError(err.message);
            } finally {
                // Reset loading state
                const generateButtonText = document.getElementById('generateButtonText');
                const generateButtonSpinner = document.getElementById('generateButtonSpinner');
                
                generateButtonText.textContent = 'Generate Signature';
                generateButtonSpinner.classList.add('hidden');
                generateSignatureBtn.disabled = false;
            }
        });

        copySignatureBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(signatureOutput.textContent);
                setCopyButtonState(copySignatureBtn, true);
                
                if (copiedTimeout) clearTimeout(copiedTimeout);
                copiedTimeout = setTimeout(() => {
                    setCopyButtonState(copySignatureBtn, false);
                }, 2000);
                
            } catch (err) {
                showError('Failed to copy signature');
            }
        });

        copyPayloadBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(payloadOutput.textContent);
                setCopyButtonState(copyPayloadBtn, true);
                
                if (copiedTimeout) clearTimeout(copiedTimeout);
                copiedTimeout = setTimeout(() => {
                    setCopyButtonState(copyPayloadBtn, false);
                }, 2000);
                
            } catch (err) {
                showError('Failed to copy payload');
            }
        });

        // Initialize the app
        init();
    </script>
    </body>
</html>